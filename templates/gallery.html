{% extends "base.html" %}

{% block title %}Gallery - {{ config.site_title }}{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <h1 class="page-title">Gallery</h1>
        <p class="page-description">作品一覧</p>
    </div>
</section>

<section class="section gallery-section">
    <div class="container">
        <!-- 検索バー -->
        <div class="search-section">
            <div class="search-box">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input type="text" id="search-input" class="search-input" placeholder="作品タイトル、タグ、説明文で検索...">
                <button id="clear-search" class="clear-search" style="display: none;">✕</button>
            </div>
            <div id="search-results-count" class="search-results-count"></div>
        </div>

        <!-- タグクラウド -->
        <div class="tag-cloud-section">
            <h3 class="tag-cloud-title">人気タグ</h3>
            <div id="tag-cloud" class="tag-cloud">
                <!-- JavaScriptで動的生成 -->
            </div>
        </div>

        <!-- フィルター -->
        <div class="gallery-filters">
            <div class="filter-group">
                <label class="filter-label">カテゴリ:</label>
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all">すべて</button>
                    {% for category in categories %}
                    <button class="filter-btn" data-filter="category" data-value="{{ category }}">{{ category }}</button>
                    {% endfor %}
                </div>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">タグ:</label>
                <div class="filter-tags">
                    {% for tag in tags %}
                    <button class="tag-filter" data-tag="{{ tag }}">{{ tag }}</button>
                    {% endfor %}
                </div>
            </div>
            
            <div class="filter-group">
                <label class="filter-checkbox">
                    <input type="checkbox" id="show-r18">
                    <span>R-18作品のみ表示</span>
                </label>
            </div>
            
            <div class="filter-group">
                <label class="filter-checkbox">
                    <input type="checkbox" id="show-r15">
                    <span>R-15作品のみ表示</span>
                </label>
            </div>
        </div>

        <!-- 作品グリッド -->
        <div class="works-grid" id="works-grid">
            {% for work in works %}
            <div class="work-card" 
                 data-nsfw="{{ work.nsfw|lower }}" 
                 data-sensitive="{{ work.sensitive|default(false)|lower }}" 
                 data-category="{{ work.category }}"
                 data-tags="{{ work.tags|join(',') }}"
                 data-date="{{ work.date }}">
                <a href="{{ base_path }}/works/{{ work.slug }}.html" class="work-link">
                    <div class="work-image">
                        <img src="{{ base_path }}{{ work.thumbnail }}" alt="{{ work.title }}" loading="lazy">
                        {% if work.image_path.endswith(('.mp4', '.mov', '.webm')) %}
                        <div class="video-indicator">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="white" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        </div>
                        {% endif %}
                        {% if work.nsfw %}
                        <div class="nsfw-overlay">
                            <span class="nsfw-label">R-18</span>
                            <p class="nsfw-message">クリックして表示</p>
                        </div>
                        {% endif %}
                    </div>
                    <div class="work-info">
                        <h3 class="work-title">{{ work.title }}</h3>
                        <div class="work-tags">
                            {% for tag in work.tags[:3] %}
                            <span class="tag">{{ tag }}</span>
                            {% endfor %}
                        </div>
                        <p class="work-date">{{ work.date }}</p>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>

        <!-- 結果が0件の場合 -->
        <div id="no-results" class="no-results" style="display: none;">
            <p>条件に一致する作品が見つかりませんでした。</p>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="{{ base_path }}/static/js/gallery.js"></script>
{% endblock %}
