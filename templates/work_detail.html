{% extends "base.html" %}

{% block title %}{{ work.title }} - {{ config.site_title }}{% endblock %}
{% block meta_description %}{{ work.description }}{% endblock %}
{% block og_title %}{{ work.title }} - {{ config.site_name }}{% endblock %}
{% block og_description %}{{ work.description }}{% endblock %}
{% block og_image %}{% if work.nsfw or work.sensitive %}{{ config.site_url }}{{ base_path }}/static/img/works/placeholder.svg{% else %}{{ config.site_url }}{{ base_path }}{{ work.thumbnail }}{% endif %}{% endblock %}
{% block og_url %}{{ config.site_url }}{{ base_path }}/works/{{ work.slug }}.html{% endblock %}
{% block og_type %}article{% endblock %}

{% block extra_meta %}
<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ work.title }} - {{ config.site_name }}">
<meta name="twitter:description" content="{{ work.description }}">
<meta name="twitter:image" content="{% if work.nsfw or work.sensitive %}{{ config.site_url }}{{ base_path }}/static/img/works/placeholder.svg{% else %}{{ config.site_url }}{{ base_path }}{{ work.thumbnail }}{% endif %}">
{% if config.social_links.twitter %}
<meta name="twitter:site" content="@{{ config.social_links.twitter_handle }}">
<meta name="twitter:creator" content="@{{ config.social_links.twitter_handle }}">
{% endif %}
{% endblock %}

{% block extra_css %}
<style>
    /* å‰å¾ŒãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
    .work-navigation {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 1.5rem 0;
        gap: 1rem;
    }

    .nav-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.25rem;
        background: var(--bg-secondary);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        color: var(--text-primary);
        text-decoration: none;
        transition: all 0.3s ease;
        flex: 1;
        max-width: 250px;
    }

    .nav-btn:hover {
        background: var(--bg-hover);
        border-color: var(--accent-primary);
        transform: translateY(-2px);
    }

    .nav-btn.disabled {
        opacity: 0.3;
        pointer-events: none;
    }

    .nav-btn.prev {
        justify-content: flex-start;
    }

    .nav-btn.next {
        justify-content: flex-end;
        margin-left: auto;
    }

    .nav-btn svg {
        flex-shrink: 0;
    }

    .nav-btn-content {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        min-width: 0;
    }

    .nav-btn.next .nav-btn-content {
        align-items: flex-end;
    }

    .nav-btn-title {
        font-size: 0.9rem;
        font-weight: 500;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 180px;
    }

    @media (max-width: 768px) {
        .work-navigation {
            gap: 0.5rem;
        }

        .nav-btn {
            padding: 0.5rem 0.75rem;
            max-width: 150px;
        }

        .nav-btn-title {
            font-size: 0.8rem;
            max-width: 100px;
        }
    }

    .additional-images {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        overflow-x: auto;
        padding: 10px 0;
    }

    .additional-images .thumbnail {
        flex-shrink: 0;
        width: 100px;
        height: 100px;
        border-radius: 8px;
        overflow: hidden;
        cursor: pointer;
        border: 3px solid transparent;
        transition: all 0.3s ease;
        opacity: 0.6;
    }

    .additional-images .thumbnail:hover {
        opacity: 1;
        transform: scale(1.05);
    }

    .additional-images .thumbnail.active {
        border-color: var(--accent-primary);
        opacity: 1;
    }

    .additional-images .thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    @media (max-width: 768px) {
        .additional-images .thumbnail {
            width: 80px;
            height: 80px;
        }
    }
</style>
{% endblock %}

{% block content %}
<section class="work-detail-section">
    <div class="container">
        <div class="breadcrumb">
            <a href="{{ base_path }}/">Home</a>
            <span class="separator">/</span>
            <a href="{{ base_path }}/gallery.html">Gallery</a>
            <span class="separator">/</span>
            <span>{{ work.title }}</span>
        </div>

        <!-- å‰å¾ŒãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div class="work-navigation">
            {% if prev_work %}
            <a href="{{ base_path }}/works/{{ prev_work.slug }}.html" class="nav-btn prev">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
                <div class="nav-btn-content">
                    <span class="nav-btn-title">{{ prev_work.title }}</span>
                </div>
            </a>
            {% else %}
            <div class="nav-btn prev disabled">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
                <div class="nav-btn-content">
                    <span class="nav-btn-title">ãªã—</span>
                </div>
            </div>
            {% endif %}

            {% if next_work %}
            <a href="{{ base_path }}/works/{{ next_work.slug }}.html" class="nav-btn next">
                <div class="nav-btn-content">
                    <span class="nav-btn-title">{{ next_work.title }}</span>
                </div>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </a>
            {% else %}
            <div class="nav-btn next disabled">
                <div class="nav-btn-content">
                    <span class="nav-btn-title">ãªã—</span>
                </div>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </div>
            {% endif %}
        </div>

        <div class="work-detail">
            <div class="work-detail-main">
                <!-- ä½œå“ç”»åƒ -->
                <div class="work-detail-image">
                    {% if work.nsfw %}
                    <div class="nsfw-warning" id="nsfw-warning">
                        <div class="nsfw-warning-content">
                            <h3>âš ï¸ R-18ä½œå“</h3>
                            <p>ã“ã®ä½œå“ã¯æˆäººå‘ã‘ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã™ã€‚<br>18æ­³æœªæº€ã®æ–¹ã¯é–²è¦§ã‚’ã”é æ…®ãã ã•ã„ã€‚</p>
                            <button id="show-nsfw" class="btn btn-primary">18æ­³ä»¥ä¸Šã§ã™ï¼ˆè¡¨ç¤ºã™ã‚‹ï¼‰</button>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if work.image_path.endswith(('.mp4', '.mov', '.webm')) %}
                    <video src="{{ base_path }}{{ work.image_path }}" 
                           class="work-image {% if work.nsfw %}nsfw-blur{% endif %}"
                           id="work-image"
                           controls
                           loop
                           muted
                           playsinline
                           poster="{{ base_path }}{{ work.thumbnail }}">
                        ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯å‹•ç”»å†ç”Ÿã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚
                    </video>
                    {% else %}
                    <img src="{{ base_path }}{{ work.image_path }}" 
                         alt="{{ work.title }}" 
                         class="work-image {% if work.nsfw %}nsfw-blur{% endif %}"
                         id="work-image">
                    {% endif %}
                    
                    {% if work.additional_images %}
                    <!-- è¿½åŠ ç”»åƒã®ã‚µãƒ ãƒã‚¤ãƒ« -->
                    <div class="additional-images">
                        <div class="thumbnail active" data-image="{{ base_path }}{{ work.image_path }}">
                            <img src="{{ base_path }}{{ work.image_path }}" alt="ç”»åƒ1">
                        </div>
                        {% for img_path in work.additional_images %}
                        <div class="thumbnail" data-image="{{ base_path }}{{ img_path }}">
                            <img src="{{ base_path }}{{ img_path }}" alt="ç”»åƒ{{ loop.index + 1 }}">
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <button class="lightbox-btn" id="lightbox-btn" title="æ‹¡å¤§è¡¨ç¤º" style="{% if work.image_path.endswith(('.mp4', '.mov', '.webm')) %}display:none;{% endif %}">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="work-detail-sidebar">
                <!-- ä½œå“æƒ…å ± -->
                <div class="work-detail-info">
                    <h1 class="work-detail-title">{{ work.title }}</h1>
                    
                    <!-- è¡¨ç¤ºå›æ•°ãƒ»ã„ã„ã­ -->
                    <div class="work-stats">
                        <div class="stat-item">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                            <span id="view-count" data-work-id="{{ work.slug }}">0</span>
                        </div>
                        <button class="like-btn" id="like-btn" data-work-id="{{ work.slug }}" title="ã„ã„ã­">
                            <svg class="heart-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                            </svg>
                            <span id="like-count">0</span>
                        </button>
                    </div>
                    
                    <div class="work-meta">
                        <div class="meta-item">
                            <span class="meta-label">å…¬é–‹æ—¥:</span>
                            <span class="meta-value">{{ work.date }}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">ã‚«ãƒ†ã‚´ãƒª:</span>
                            <span class="meta-value">{{ work.category }}</span>
                        </div>
                    </div>

                    <div class="work-tags">
                        {% for tag in work.tags %}
                        <span class="tag">{{ tag }}</span>
                        {% endfor %}
                    </div>

                    {% if work.description %}
                    <p class="work-description">{{ work.description }}</p>
                    {% endif %}

                    <!-- ã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³ -->
                    <div class="work-share-section">
                        <h3 class="subsection-title">ã‚·ã‚§ã‚¢</h3>
                        <div class="share-buttons">
                            <button class="share-btn share-twitter" id="share-twitter" title="Xã§ã‚·ã‚§ã‚¢">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                                </svg>
                                X
                            </button>
                            <button class="share-btn share-facebook" id="share-facebook" title="Facebookã§ã‚·ã‚§ã‚¢">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                                </svg>
                                Facebook
                            </button>
                            <button class="share-btn share-copy" id="share-copy" title="URLã‚’ã‚³ãƒ”ãƒ¼">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                                ã‚³ãƒ”ãƒ¼
                            </button>
                        </div>
                        <div id="copy-notification" class="copy-notification" style="display: none;">URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</div>
                    </div>

                    <!-- å¤–éƒ¨ãƒªãƒ³ã‚¯ -->
                    {% if work.external_links %}
                    <div class="work-external-links">
                        <h3 class="subsection-title">ä»–ã‚µã‚¤ãƒˆã§è¦‹ã‚‹</h3>
                        <div class="external-links-list">
                            {% if work.external_links.pixiv %}
                            <a href="{{ work.external_links.pixiv }}" target="_blank" rel="noopener" class="external-link">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M4.935 0A4.924 4.924 0 0 0 0 4.935v14.13A4.924 4.924 0 0 0 4.935 24h14.13A4.924 4.924 0 0 0 24 19.065V4.935A4.924 4.924 0 0 0 19.065 0zm7.81 4.547c2.181 0 4.058.676 5.399 1.847a6.118 6.118 0 0 1 2.116 4.66c.005 1.854-.88 3.476-2.257 4.563-1.375 1.092-3.225 1.697-5.258 1.697H9.177v4.394c0 .272-.221.492-.493.492H6.427a.492.492 0 0 1-.492-.492V5.04c0-.272.22-.493.492-.493zm-.44 9.255h2.858c1.458 0 2.659-.417 3.376-1.153.726-.746 1.147-1.832 1.147-3.069 0-1.238-.421-2.323-1.147-3.07-.717-.735-1.918-1.152-3.376-1.152H9.177v8.444z"/>
                                </svg>
                                Pixiv
                            </a>
                            {% endif %}
                            {% if work.external_links.twitter %}
                            <a href="{{ work.external_links.twitter }}" target="_blank" rel="noopener" class="external-link">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                                </svg>
                                Twitter
                            </a>
                            {% endif %}
                            {% if work.external_links.booth %}
                            <a href="{{ work.external_links.booth }}" target="_blank" rel="noopener" class="external-link">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2zm-1 4v12h2V6h-2z"/>
                                </svg>
                                BOOTH
                            </a>
                            {% endif %}
                            {% if work.external_links.fanbox %}
                            <a href="{{ work.external_links.fanbox }}" target="_blank" rel="noopener" class="external-link">
                                FANBOX
                            </a>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- åˆ©ç”¨è¦ç´„ -->
                    <div class="work-terms">
                        <h3 class="subsection-title">åˆ©ç”¨ã«ã¤ã„ã¦</h3>
                        <p class="terms-text">
                            ã“ã®ä½œå“ã®è‘—ä½œæ¨©ã¯{{ config.author.name }}ã«å¸°å±ã—ã¾ã™ã€‚<br>
                            ç„¡æ–­è»¢è¼‰ãƒ»ç„¡æ–­ä½¿ç”¨ã¯å›ºããŠæ–­ã‚Šã—ã¾ã™ã€‚<br>
                            å…±æœ‰ã™ã‚‹å ´åˆã¯å…ƒãƒ„ã‚¤ãƒ¼ãƒˆã®RTã€ã¾ãŸã¯ã“ã®ãƒšãƒ¼ã‚¸ã®URLã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ -->
        <div class="work-comments-section">
            <h2 class="section-title">Comments</h2>
            <p class="comments-intro">ã“ã®ä½œå“ã¸ã®ã‚³ãƒ¡ãƒ³ãƒˆãƒ»æ„Ÿæƒ³ã‚’ãŠå¾…ã¡ã—ã¦ã„ã¾ã™ï¼ã‚³ãƒ¡ãƒ³ãƒˆãŒæŠ•ç¨¿ã•ã‚Œã‚‹ã¨ä½œè€…ã«é€šçŸ¥ã•ã‚Œã¾ã™ã€‚</p>
            
            <div class="comment-form-wrapper">
                <form action="{{ config.contact_form_action }}" method="POST" class="comment-form" id="comment-form">
                    <!-- ä½œå“æƒ…å ±ï¼ˆhiddenï¼‰ -->
                    <input type="hidden" name="_subject" value="ğŸ’¬ ã€{{ work.title }}ã€‘ã¸ã®ã‚³ãƒ¡ãƒ³ãƒˆ">
                    <input type="hidden" name="ä½œå“ã‚¿ã‚¤ãƒˆãƒ«" value="{{ work.title }}">
                    <input type="hidden" name="ä½œå“URL" value="{{ config.site_url }}{{ base_path }}/works/{{ work.slug }}.html">
                    
                    <div class="form-group">
                        <label for="comment-name" class="form-label">
                            ãŠåå‰ <span class="optional">(ä»»æ„)</span>
                        </label>
                        <input type="text" id="comment-name" name="name" class="form-input" placeholder="åŒ¿åã§ã‚‚OK">
                    </div>

                    <div class="form-group">
                        <label for="comment-message" class="form-label">
                            ã‚³ãƒ¡ãƒ³ãƒˆ <span class="required">*</span>
                        </label>
                        <textarea id="comment-message" name="message" class="form-textarea" rows="4" placeholder="æ„Ÿæƒ³ã‚„å¿œæ´ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãªã©" required></textarea>
                    </div>

                    <!-- ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆï¼ˆã‚¹ãƒ‘ãƒ å¯¾ç­–ï¼‰ -->
                    <div class="honeypot">
                        <input type="text" name="_gotcha" tabindex="-1" autocomplete="off">
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" id="comment-submit-btn">ã‚³ãƒ¡ãƒ³ãƒˆã‚’é€ä¿¡</button>
                    </div>
                </form>

                <!-- é€ä¿¡å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                <div id="comment-success" class="form-message form-success" style="display: none;">
                    <h3>âœ“ é€ä¿¡å®Œäº†</h3>
                    <p>ã‚³ãƒ¡ãƒ³ãƒˆã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼<br>ä½œè€…ã«é€šçŸ¥ã•ã‚Œã¾ã—ãŸã€‚</p>
                </div>

                <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                <div id="comment-error" class="form-message form-error" style="display: none;">
                    <h3>âœ• é€ä¿¡ã‚¨ãƒ©ãƒ¼</h3>
                    <p>é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</p>
                </div>
            </div>

            <div class="comment-note">
                <p>â€» ã‚³ãƒ¡ãƒ³ãƒˆã¯å…¬é–‹ã•ã‚Œã¾ã›ã‚“ã€‚ä½œè€…ã®ã¿ã«å±Šãã¾ã™ã€‚</p>
                <p>â€» è¿”ä¿¡ãŒå¿…è¦ãªå ´åˆã¯<a href="{{ base_path }}/contact.html">Contactãƒšãƒ¼ã‚¸</a>ã‹ã‚‰ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨˜è¼‰ã—ã¦ã”é€£çµ¡ãã ã•ã„ã€‚</p>
            </div>
        </div>

        <!-- é–¢é€£ä½œå“ -->
        {% if related_works %}
        <div class="related-works">
            <h2 class="section-title">Related Works</h2>
            <div class="works-grid">
                {% for related in related_works %}
                <div class="work-card" data-nsfw="{{ related.nsfw|lower }}">
                    <a href="{{ base_path }}/works/{{ related.slug }}.html" class="work-link">
                        <div class="work-image">
                            <img src="{{ base_path }}{{ related.thumbnail }}" alt="{{ related.title }}" loading="lazy">
                            {% if related.nsfw %}
                            <div class="nsfw-overlay">
                                <span class="nsfw-label">R-18</span>
                            </div>
                            {% endif %}
                        </div>
                        <div class="work-info">
                            <h3 class="work-title">{{ related.title }}</h3>
                            <div class="work-tags">
                                {% for tag in related.tags[:2] %}
                                <span class="tag">{{ tag }}</span>
                                {% endfor %}
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- ãƒ©ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹ -->
<div id="lightbox" class="lightbox" style="display: none;">
    <button class="lightbox-close" id="lightbox-close">&times;</button>
    <img src="" alt="" id="lightbox-image">
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ base_path }}/static/js/work_detail.js"></script>
{% endblock %}
